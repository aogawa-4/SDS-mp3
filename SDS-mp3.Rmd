---
title: "SDS-mp3"
author: "Aoi Ogawa, Stella Li, Ester Zhao"
date: "4/3/2018"
output: html_document
---

```{r}

library(tidyverse)
library(sf)
library(macleish)
library(leaflet)

```


We are doing #5. 


```{r}
# getting the table of maple syrup data and weather data

macleish <- etl("macleish")

str(macleish)

macleish %>%
etl_extract() %>%
etl_transform() %>%
etl_load()

whately <- macleish %>%
tbl("whately")

weather <- data.frame(whately)

weather_time <- data.frame(whately)

maple_sap <- data.frame(maple_sap)

```


```{r}
# mappping the maple trees (including birch trees)
maple_forest <- macleish_layers[["forests"]] %>% 
  filter(VegType_21 == "3")

birch_maple_forest <- macleish_layers[["forests"]] %>% 
  filter(VegType_21 == "13" )


leaflet() %>%
  addTiles() %>%
  addPolygons(data = maple_forest, color = "red") %>%
  addPolygons(data = birch_maple_forest, color = "yellow")
```

```{r}
# # Change the when column fron date/month/year/time into date/month/year
# 
# weather$when <- format(as.Date(weather$when), "%d / %m /%Y")
```



```{r}
# making the maple syrup density graph

sap <- maple_sap %>% 
  filter(!is.na(sap)) %>%
  separate(when, c("year", "month", "day"), sep = "-")

f_weather <- weather_time %>% 
  separate(when,c("year", "month", "day"), sep = "-") %>%
  separate(day, c("day", "time"), sep = "T")

```


```{r}
macleish_data_wrangle <- function(){

library(macleish)

macleish <- etl("macleish")

str(macleish)
macleish %>%
etl_extract() %>%
etl_transform() %>%
etl_load()

whately <- macleish %>%
tbl("whately")

weather <- data.frame(whately)

weather_time <- data.frame(whately)

maple_sap <- data.frame(maple_sap)

}


# ggplot(sap, aes(x = when, y = sap)) +
#   geom_point()


  # geom_area(fill = "darkgoldenrod1") + 
  # geom_line()

```






```{r}
f_weather$wind_speed <- NULL
f_weather$wind_dir <- NULL
f_weather$rel_humidity <- NULL
f_weather$pressure <- NULL
f_weather$solar_radiation <- NULL
f_weather$rainfall <- NULL

sap_weather <- inner_join(f_weather, sap) 

sap_weather$Comments <- NULL

sap_weather <- group_by(year, month, day, < time) %>%

```


```{r}
ggplot(sap_weather, aes(x = time, y = sap)) + 
  geom_point()
```

```{r}
daytime_sap_data <- sap_weather %>%
  group_by(year,month,day) %>%
  filter(time >= "06:00:00Z" &
           time <="18:00:00Z") %>% 
  summarize(day_avg_temp = mean(temperature))


nighttime_sap_data <- sap_weather %>%
    group_by(year,month,day) %>%
  filter(time >= "00:00:00Z" &
           time < "06:00:00Z" |
           time > "18:00:00Z" &
           time < "24:00:00Z") %>%
  summarize(night_avg_temp = mean(temperature))
  
final_sap <- inner_join(daytime_sap_data, nighttime_sap_data)

View(daytime_sap_data)

nighttime_sap_data
```
